<!DOCTYPE html>

<head>
    <title>Notes Tracker</title>

    <!-- Dynamic stylesheet - so no href to begin with -->
    <link id="theme_css" rel="stylesheet">

    <script type="application/javascript">
        const theme_css_element = document.getElementById('theme_css')
        const default_css = localStorage.getItem('default_css')

        if (default_css) theme_css_element.href = default_css
    </script>

    <link rel="shortcut icon" href="/static/img/icon-note.svg">
</head>

<body>
    <nav class="navbar has-background-primary" role="navigation">
        <div class="navbar-brand">
            <div class="navbar-item">
                <img src="/static/img/icon-notebook.svg">
                Note Tracker
            </div>
        </div>

        <div class="navbar-end">
            <div class="navbar-item">
                <div class="control has-icons-left">
                    <div class="select">
                        <select id="theme_select">
                        </select>
                    </div>

                    <div class="icon is-left">
                        <img src="/static/img/icon-color-swatch.svg">
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <section class="section">
        <div class="container">
            <div id="app"></div>
        </div>
    </section>

    <script type="application/javascript">
        /**
         * Get default theme from storage or default value.
         */
        function get_default_theme() {
            let default_theme = localStorage.getItem('default_theme')
            if (!default_theme) {
                default_theme = 'Default'
                localStorage.setItem('default_theme', default_theme)
            }

            return default_theme
        }

        /**
         * Populate options of select element from array of themes.
         */
        function select_from_array(select, array) {
            const default_theme = get_default_theme()
            let default_css = '';

            for (const val of array) {
                const is_selected = val.name === default_theme
                if (is_selected) default_css = val.css

                const option = new Option(
                    val.name,
                    val.css,
                    is_selected,
                    is_selected
                )

                select.add(option)
            }

            return default_css
        }

        const theme_select_element = document.getElementById('theme_select')

        fetch('https://jenil.github.io/bulmaswatch/api/themes.json')
            .then(resp => resp.json())
            .then(resp => select_from_array(theme_select_element, resp.themes))
            .then(selected_css => theme_css_element.href = selected_css)
            .catch(err => console.log(err))

        theme_select.addEventListener('change', (event) => {
            const select = event.target
            theme_css_element.href = select.value
            localStorage.setItem('default_theme', select.options[select.selectedIndex].text)
            localStorage.setItem('default_css', select.value)
        })
    </script>

    <script type="module" src="static/js/app.js"></script>
</body>